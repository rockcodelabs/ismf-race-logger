<% content_for :page_title, "User Details" %>

<div class="h-screen touch-spacing overflow-hidden flex flex-col" data-controller="touch-confirm">
  <!-- User Details Card -->
  <div class="bg-white rounded-2xl shadow-xl p-4 flex-1 flex flex-col min-h-0">
    <div class="touch-scrollable flex-1">
      
      <!-- Avatar and Basic Info -->
      <div class="text-center mb-6">
        <div class="w-24 h-24 mx-auto bg-linear-to-br from-ismf-blue to-blue-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-white font-extrabold text-4xl">
            <%= @user.name.first.upcase rescue @user.email_address.first.upcase %>
          </span>
        </div>
        <h2 class="text-2xl font-bold text-ismf-navy mb-2"><%= @user.name.presence || "â€”" %></h2>
        <p class="text-lg text-ismf-gray mb-3"><%= @user.email_address %></p>
        <div class="inline-flex">
          <% if @user.admin? %>
            <span class="px-5 py-2 rounded-xl text-base font-bold text-white bg-ismf-red shadow-md">Administrator</span>
          <% else %>
            <span class="px-5 py-2 rounded-xl text-base font-bold text-white bg-ismf-blue shadow-md">User</span>
          <% end %>
        </div>
      </div>

      <!-- Details Grid -->
      <div class="space-y-4 mb-6">
        <div class="bg-gray-50 rounded-xl p-4 border-2 border-gray-100">
          <dt class="text-base font-bold text-ismf-gray mb-1">Account Created</dt>
          <dd class="text-lg text-ismf-navy font-semibold"><%= @user.created_at.strftime("%B %d, %Y") %></dd>
          <dd class="text-sm text-ismf-gray"><%= @user.created_at.strftime("%I:%M %p") %></dd>
        </div>

        <div class="bg-gray-50 rounded-xl p-4 border-2 border-gray-100">
          <dt class="text-base font-bold text-ismf-gray mb-1">Last Updated</dt>
          <dd class="text-lg text-ismf-navy font-semibold"><%= @user.updated_at.strftime("%B %d, %Y") %></dd>
          <dd class="text-sm text-ismf-gray"><%= @user.updated_at.strftime("%I:%M %p") %></dd>
        </div>

        <div class="bg-gray-50 rounded-xl p-4 border-2 border-gray-100">
          <dt class="text-base font-bold text-ismf-gray mb-1">Active Sessions</dt>
          <dd class="text-lg text-ismf-navy font-semibold"><%= @user.sessions.count %> session(s)</dd>
        </div>
      </div>

      <!-- Sessions List -->
      <% if @user.sessions.any? %>
        <div class="mb-6">
          <h3 class="text-xl font-bold text-ismf-navy mb-3">Active Sessions</h3>
          <div class="space-y-3">
            <% @user.sessions.order(created_at: :desc).each do |session| %>
              <div class="bg-gray-50 rounded-xl p-3 border-2 border-gray-100">
                <p class="text-sm font-bold text-ismf-gray mb-1">IP Address</p>
                <p class="text-base text-ismf-navy font-mono mb-2"><%= session.ip_address || "Unknown" %></p>
                <p class="text-xs text-ismf-gray"><%= session.created_at.strftime("%b %d, %Y at %I:%M %p") %></p>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

    </div>

    <!-- Action Buttons -->
    <div class="shrink-0 pt-4 border-t-2 border-gray-100">
      <div class="flex flex-col gap-3">
        <!-- Edit Button (Full Width) -->
        <%= link_to edit_admin_user_path(@user), class: "touch-btn touch-btn-primary w-full" do %>
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 2rem; height: 2rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        <span>Edit User</span>
        <% end %>

        <!-- Delete and Back Buttons (Side by Side) -->
        <div class="flex flex-row gap-3">
          <% unless @user == Current.user %>
            <button type="button"
                    data-action="touch-confirm#show"
                    data-touch-confirm-message-param="Delete <%= @user.display_name %>? This cannot be undone."
                    data-touch-confirm-url-param="<%= admin_user_path(@user) %>"
                    data-touch-confirm-method-param="delete"
                    class="touch-btn bg-linear-to-r! from-red-500! to-red-600! text-white! min-h-[88px]">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 2rem; height: 2rem;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              <span>Delete User</span>
            </button>
          <% end %>

          <%= link_to admin_users_path, class: "touch-btn touch-btn-secondary flex-1" do %>
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 2rem; height: 2rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span>Back to Users</span>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>