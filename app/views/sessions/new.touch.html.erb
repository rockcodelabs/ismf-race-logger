<div class="min-h-screen flex flex-col items-center justify-center touch-spacing">
  <!-- Large Logo -->
  <div class="touch-logo mb-6">
    <svg class="text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
    </svg>
  </div>
  
  <!-- Title -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-extrabold text-white mb-2">ISMF Race Logger</h1>
    <p class="text-xl text-white/70 font-semibold">Touch to Sign In</p>
  </div>

  <!-- Login Form Card -->
  <div class="w-full max-w-2xl bg-white rounded-3xl shadow-2xl touch-spacing-lg" id="login-card">
    <!-- Flash messages -->
    <% if alert = flash[:alert] %>
      <div class="touch-flash touch-flash-alert mb-6">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span><%= alert %></span>
      </div>
    <% end %>

    <% if notice = flash[:notice] %>
      <div class="touch-flash touch-flash-notice mb-6">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span><%= notice %></span>
      </div>
    <% end %>

    <!-- Form -->
    <%= form_with url: session_url, class: "space-y-8", id: "login-form" do |form| %>
      <div>
        <label for="email_address" class="touch-label">Email</label>
        <%= form.email_field :email_address, 
            required: true, 
            autofocus: true, 
            autocomplete: "username", 
            inputmode: "email",
            placeholder: "your@email.com", 
            value: params[:email_address], 
            class: "touch-input",
            id: "email_address" %>
      </div>

      <div>
        <label for="password" class="touch-label">Password</label>
        <%= form.password_field :password, 
            required: true, 
            autocomplete: "current-password",
            inputmode: "text",
            placeholder: "Enter password", 
            maxlength: 72, 
            class: "touch-input",
            id: "password" %>
      </div>

      <div class="flex flex-col gap-4">
        <%= form.submit "Sign In", class: "touch-btn touch-btn-primary cursor-pointer" %>
        
        <%= link_to root_path, class: "touch-btn touch-btn-secondary" do %>
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 2rem; height: 2rem;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          <span>Back</span>
        <% end %>
      </div>
    <% end %>
    
    <!-- Virtual Keyboard - ALWAYS VISIBLE FOR TESTING -->
    <div id="virtual-keyboard" style="display: block; position: fixed; bottom: 0; left: 0; right: 0; background: #2c3e50; padding: 1rem; z-index: 9999; border-top: 3px solid #e94560;">
      <div style="background: #e94560; color: white; padding: 0.5rem; margin-bottom: 0.5rem; text-align: center; font-weight: 700;">
        TOUCH KEYBOARD ACTIVE - TAP ON INPUT FIELDS
      </div>
      <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
        <button class="kbd-key" data-key="1">1</button>
        <button class="kbd-key" data-key="2">2</button>
        <button class="kbd-key" data-key="3">3</button>
        <button class="kbd-key" data-key="4">4</button>
        <button class="kbd-key" data-key="5">5</button>
        <button class="kbd-key" data-key="6">6</button>
        <button class="kbd-key" data-key="7">7</button>
        <button class="kbd-key" data-key="8">8</button>
        <button class="kbd-key" data-key="9">9</button>
        <button class="kbd-key" data-key="0">0</button>
      </div>
      <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
        <button class="kbd-key" data-key="q">q</button>
        <button class="kbd-key" data-key="w">w</button>
        <button class="kbd-key" data-key="e">e</button>
        <button class="kbd-key" data-key="r">r</button>
        <button class="kbd-key" data-key="t">t</button>
        <button class="kbd-key" data-key="y">y</button>
        <button class="kbd-key" data-key="u">u</button>
        <button class="kbd-key" data-key="i">i</button>
        <button class="kbd-key" data-key="o">o</button>
        <button class="kbd-key" data-key="p">p</button>
      </div>
      <div style="display: grid; grid-template-columns: repeat(9, 1fr); gap: 0.5rem; margin-bottom: 0.5rem; padding-left: 2rem;">
        <button class="kbd-key" data-key="a">a</button>
        <button class="kbd-key" data-key="s">s</button>
        <button class="kbd-key" data-key="d">d</button>
        <button class="kbd-key" data-key="f">f</button>
        <button class="kbd-key" data-key="g">g</button>
        <button class="kbd-key" data-key="h">h</button>
        <button class="kbd-key" data-key="j">j</button>
        <button class="kbd-key" data-key="k">k</button>
        <button class="kbd-key" data-key="l">l</button>
      </div>
      <div style="display: grid; grid-template-columns: 1.5fr repeat(7, 1fr) 1.5fr; gap: 0.5rem; margin-bottom: 0.5rem;">
        <button class="kbd-key kbd-shift" data-key="shift">⇧</button>
        <button class="kbd-key" data-key="z">z</button>
        <button class="kbd-key" data-key="x">x</button>
        <button class="kbd-key" data-key="c">c</button>
        <button class="kbd-key" data-key="v">v</button>
        <button class="kbd-key" data-key="b">b</button>
        <button class="kbd-key" data-key="n">n</button>
        <button class="kbd-key" data-key="m">m</button>
        <button class="kbd-key kbd-backspace" data-key="backspace">⌫</button>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr 3fr 1fr 1fr; gap: 0.5rem;">
        <button class="kbd-key" data-key="@">@</button>
        <button class="kbd-key" data-key=".">.</button>
        <button class="kbd-key kbd-space" data-key=" ">space</button>
        <button class="kbd-key" data-key="-">-</button>
        <button class="kbd-key kbd-hide" style="background: #e94560;">Hide</button>
      </div>
    </div>
  </div>
  
  <style>
    .kbd-key {
      background: #34495e;
      color: white;
      border: 2px solid #4a5f7f;
      border-radius: 0.5rem;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.1s;
      min-height: 60px;
      user-select: none;
      -webkit-user-select: none;
    }
    .kbd-key:active {
      transform: scale(0.95);
      background: #4a5f7f;
    }
    .kbd-shift, .kbd-backspace, .kbd-space {
      font-size: 1.25rem;
    }
  </style>
  
  <script>
    (function() {
      let activeInput = null;
      let isShiftActive = false;
      const keyboard = document.getElementById('virtual-keyboard');
      const emailInput = document.getElementById('email_address');
      const passwordInput = document.getElementById('password');
      const loginCard = document.getElementById('login-card');
      
      // Debug log
      console.log('Touch keyboard script loaded');
      console.log('Email input:', emailInput);
      console.log('Password input:', passwordInput);
      console.log('Keyboard element:', keyboard);
      
      // Show keyboard on input focus
      [emailInput, passwordInput].forEach(input => {
        input.addEventListener('focus', function() {
          console.log('Input focused:', this.id);
          activeInput = this;
          keyboard.style.display = 'block';
          // Scroll to keep input visible
          setTimeout(() => {
            loginCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        });
      });
      
      // Handle keyboard clicks
      keyboard.addEventListener('click', function(e) {
        if (!e.target.classList.contains('kbd-key')) return;
        
        const key = e.target.dataset.key;
        
        if (!activeInput) return;
        
        if (key === 'backspace') {
          const val = activeInput.value;
          activeInput.value = val.substring(0, val.length - 1);
        } else if (key === 'shift') {
          isShiftActive = !isShiftActive;
          e.target.style.background = isShiftActive ? '#e94560' : '#34495e';
        } else if (e.target.classList.contains('kbd-hide')) {
          keyboard.style.display = 'none';
          activeInput = null;
        } else {
          let char = key;
          if (isShiftActive && key.length === 1 && key.match(/[a-z]/)) {
            char = key.toUpperCase();
            isShiftActive = false;
            document.querySelector('.kbd-shift').style.background = '#34495e';
          }
          activeInput.value += char;
        }
        
        // Trigger input event for any validation
        activeInput.dispatchEvent(new Event('input', { bubbles: true }));
      });
      
      // Audio feedback
      const playClick = () => {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      };
      
      keyboard.addEventListener('touchstart', playClick, { passive: true });
    })();
  </script>
  
  <!-- Footer -->
  <div class="mt-6">
    <p class="text-center text-white/40 text-lg font-medium">
      ISMF © <%= Date.current.year %>
    </p>
  </div>
</div>